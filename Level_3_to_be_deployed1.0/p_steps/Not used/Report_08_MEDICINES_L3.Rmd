---
title: "CONCEPTION - Level 3 checks: Medicines exposure"
output: 
  html_document:
    theme: spacelab
    toc: true
    toc_float: true
    toc_depth: 3
    output_dir: output_dir
---

```{css,  echo = F}
/*-- Specify div's for 'boxes', change color of TOC and center align titles: --*/
div.box1 {background-color: #f5f5f0; border-radius: 5px; padding: 30px; margin-right: 0px}
div.box2 {border-style: solid; border-color: #f5f5f0; border-width: medium; border-radius: 30px; padding: 5px; margin-right: 0px}
div.box3 {border-style: solid; border-color: #f5f5f0; border-width: medium; border-radius: 30px; padding: 5px; margin-right: 0px}
div.box4 {border-style: solid; border-color: #f5f5f0; border-width: medium; border-radius: 30px; padding: 5px; margin-right: 0px}
div.box5 {border-style: solid; border-color: #f5f5f0; border-width: medium; border-radius: 30px; padding: 5px; margin-right: 0px}
div.box6 {border-style: solid; border-color: #f5f5f0; border-width: medium; border-radius: 30px; padding: 5px; margin-right: 0px}
div.box7 {border-style: solid; border-color: #f5f5f0; border-width: medium; border-radius: 30px; padding: 5px; margin-right: 0px}
div.box8 {border-style: solid; border-color: #f5f5f0; border-width: medium; border-radius: 30px; padding: 5px; margin-right: 0px}
div.box9 {border-style: solid; border-color: #f5f5f0; border-width: medium; border-radius: 30px; padding: 5px; margin-right: 0px}

.list-group-item.active, .list-group-item.active:focus, .list-group-item.active:hover {background-color: #76b82a; border-color: #76b82a}
h1 {text-align: center; color: #3c7b8a}
h2 {text-align: center; color: #76b82a}

/*-- Add logo (based on https://rstudio4edu.github.io/rstudio4edu-book/rmd-fancy.html): --*/
#TOC::before {content: ""; display: block; height: 60px; margin: 30px 10px 30px; background-image: url("conception_logo.png"); background-size: contain; background-position: center center; background-repeat: no-repeat}
```

```{r set_locale, include=FALSE}
Sys.setlocale("LC_ALL", "C")
`%!in%` = Negate(`%in%`)
```

<div class = 'box1'>

**Level 3:** Medicines exposure in the study population and in females of childbearing age (12-55 years old)  

<br> 

The analysis contains the following steps:

<br>

![steps in analysis](medicines_l3.png)

If subpopulations are available in your data the analysis will be performed separately for each subpopulation.
In case there is an overlapping subpopulation only subjects in the overlap period will be taken into account.
***Example:***

<br>

![subpopulations analysis](subpopulations.png)

`year` is retrieved from `date_prescription` or `date_dispensing`. If both dates are present, `date_dispensing` will be used.

</div>

<br>

<div class = 'box2'>

## 1. Flowchart

```{r flowchart, echo=F}
if (subpopulations_present=="No"){
flowchart<-fread(paste0(med_dir,"Masked/", "medicines_flowchart_masked.csv"))
datatable(flowchart, options = list(scrollX=T))
} else {
flowchart<-fread(paste0(med_dir,subpopulations_names[a], "/Masked/", subpopulations_names[a],"_medicines_flowchart_masked.csv"))
datatable(flowchart, options = list(scrollX=T))
}
```

</div>

<br>

<div class = 'box3'>

## 2. Description of medicines_study_population

```{r description, echo=F}
if (subpopulations_present=="No"){
description<-fread(paste0(med_dir,"Masked/", "medicines_description_masked.csv"))
datatable(description, options = list(scrollX=T))
} else {
  description<-fread(paste0(med_dir,subpopulations_names[a], "/Masked/", subpopulations_names[a],"_medicines_description_masked.csv"))
datatable(description, options = list(scrollX=T))
}
```

</div>

<br>

<div class = 'box4'>

## 3. Counts in the study population

#### Number of records by ATC code, year and meaning

```{r counts_atc_1_my, echo=F}
if (subpopulations_present=="No"){
  if(sum(grepl(list.files(paste0(med_dir,"Masked/")), pattern="medicines_my_atc_1_masked.csv"))>0){
tab10<-fread(paste0(med_dir,"Masked/", "medicines_my_atc_1_masked.csv"))
if(tab10[,.N]>0){
setcolorder(tab10,c("atc_code_1", "count","total", "meaning", "year", "data_access_provider", "data_source"))
 if(tab10[,.N]>12000){
           print("If the table contanins more than 12000 records it can not be displayed in the report. For the complete table, go to g_output/MEDICINES/medicines_my_atc_1_masked.csv")
datatable(head(tab10,12000), options = list(scrollX=T))
 } else {
        datatable(tab10, options = list(scrollX=T))
 }
} else {
  tab10<-NULL
  print("This table cannot be produced based on the available data.")
}
  } else {
    tab10<-NULL
  print("This table cannot be produced based on the available data.")
}
} else {
    if(sum(grepl(list.files(paste0(med_dir,subpopulations_names[a], "/Masked/")), pattern="medicines_my_atc_1_masked.csv"))>0){
  tab10<-fread(paste0(med_dir,subpopulations_names[a], "/Masked/", subpopulations_names[a],"_medicines_my_atc_1_masked.csv"))
  if (tab10[,.N]>0){
  setcolorder(tab10,c("atc_code_1", "count","total", "meaning", "year", "data_access_provider", "data_source"))
      if(tab10[,.N]>12000){  
    print("If the table contanins more than 12000 records it can not be displayed in the report. For the complete table, go to g_output/MEDICINES/medicines_my_atc_1_masked.csv")
      datatable(head(tab10,12000), options = list(scrollX=T))
        } else {
    datatable(tab10, options = list(scrollX=T))
      }
  } else {
    tab10<-NULL
    print("This table cannot be produced based on the available data.")
}
    } else {
      tab10<-NULL
  print("This table cannot be produced based on the available data.")
    }
}
```

<br>

```{r tab10_graph, echo=FALSE, warning=FALSE}
if(!is.null(tab10)){
tab10_graph<-tab10[count=="<5", count:= 0.9]
tab10_graph<-tab10_graph[,count:=as.numeric(count)]
tab10_graph<-tab10_graph[!is.na(atc_code_1) | atc_code_1!="All"]
tab10_graph<-tab10_graph[,year:=as.factor(year)]
} else {
 tab10_graph<-NULL 
}

if(!is.null(tab10_graph)){
if (tab10_graph[,.N] != 0){
ggplotly(ggplot(tab10_graph, aes(x = year, y = count, group=atc_code_1)) +
                           geom_line(aes(color=atc_code_1)) +
                           geom_point(aes(color=atc_code_1)) + 
                            facet_wrap(~ meaning, ncol=2, scales = "fixed") +
                               ggtitle("Number of records by ATC code, year and meaning") + 
                               xlab("Year") +
                               ylab("Count")+
                             theme_classic() +
                             guides(shape = guide_legend(override.aes = list(size = 0.3))) +
                               theme(text=element_text(size=10),
                                 axis.text.x = element_text(angle = 90, hjust = 1),
                                     axis.title.x = element_text(colour = "#76b82a"),
                                     axis.title.y = element_text(colour = "#76b82a"),
                                     plot.title = element_text(colour = "#76b82a"),
                                     strip.text.y = element_text(angle = 0),
                                     legend.title = element_text(size = 7), 
               legend.text = element_text(size = 7))) 
                                     
}
} else {
  print("This table cannot be produced based on the available data.") 
}
```

<br>


#### Number of records and users by ATC code, year and meaning

```{r counts_atc_4_my, echo=F}
if (subpopulations_present=="No"){
  if(sum(grepl(list.files(paste0(med_dir,"Masked/")), pattern="medicines_my_atc_4_masked.csv"))>0){
tab12<-fread(paste0(med_dir,"Masked/", "medicines_my_atc_4_masked.csv"))
if(tab12[,.N]>0){
setcolorder(tab12,c("atc_code_4", "no_records", "no_male_users", "median_rx_male_users", "no_female_users", "median_rx_female_users","meaning", "year", "atc_code_3","atc_code_1", "data_access_provider", "data_source"))
  if(tab12[,.N]>12000){
    print("If the table contanins more than 12000 records it can not be displayed in the report. For the complete table, go to g_output/MEDICINES/medicines_my_atc_4_masked.csv")
    datatable(head(tab12,12000), options = list(scrollX=T))
  } else {
datatable(tab12, options = list(scrollX=T))
  }
} else {
  tab12<-NULL
    print("This table cannot be produced based on the available data.")
}
  } else {
    tab12<-NULL
    print("This table cannot be produced based on the available data.")
}
} else {
    if(sum(grepl(list.files(paste0(med_dir,subpopulations_names[a], "/Masked/")), pattern="medicines_my_atc_4_masked.csv"))>0){
  tab12<-fread(paste0(med_dir,subpopulations_names[a], "/Masked/", subpopulations_names[a],"_medicines_my_atc_4_masked.csv"))
  if(tab12[,.N]>0){
  setcolorder(tab12,c("atc_code_4", "no_records", "no_male_users", "median_rx_male_users", "no_female_users", "median_rx_female_users","meaning", "year", "atc_code_3","atc_code_1", "data_access_provider", "data_source"))
if(tab12[,.N]>12000){
      print("If the table contanins more than 12000 records it can not be displayed in the report. For the complete table, go to g_output/MEDICINES/medicines_my_atc_4_masked.csv")
    datatable(head(tab12,12000), options = list(scrollX=T))
  } else {
    datatable(tab12, options = list(scrollX=T))
  }
  } else {
    tab12<-NULL
    print("This table cannot be produced based on the available data.")
}
    } else {
      tab12<-NULL
    print("This table cannot be produced based on the available data.")
    }
} 
```

<br>

```{r tab12_records_graph, echo=FALSE, warning=FALSE}
if(!is.null(tab12)){
tab12_graph<-tab12[,.(meaning,year,atc_code_4,no_records,no_male_users, no_female_users, median_rx_male_users, median_rx_female_users)]
tab12_graph<-tab12_graph[no_records=="<5",no_records:=0.9]
tab12_graph<-tab12_graph[no_male_users=="<5",no_male_users:=0.9]
tab12_graph<-tab12_graph[no_female_users=="<5",no_female_users:=0.9]
tab12_graph<-tab12_graph[,year:=as.factor(year)][,no_records:=as.numeric(no_records)][,no_male_users:=as.numeric(no_male_users)][,no_female_users:=as.numeric(no_female_users)]
}

if(!is.null(tab12_graph)){
if (tab12_graph[,.N] != 0){
  tab12_graph<-tab12_graph[,no_records:=as.numeric(no_records)]
ggplotly(ggplot(tab12_graph[meaning!="All"], aes(x = year, y = no_records, group=atc_code_4)) +
                           geom_line(aes(color=atc_code_4)) +
                           geom_point(aes(color=atc_code_4)) + 
                            facet_wrap(~ meaning, ncol=2, scales = "fixed") +
                               ggtitle("Number of records by ATC code, year and meaning") + 
                               xlab("Year") +
                               ylab("Count")+
                             theme_classic() +
                             guides(shape = guide_legend(override.aes = list(size = 0.3))) +
                               theme(text=element_text(size=10),
                                 axis.text.x = element_text(angle = 90, hjust = 1),
                                     axis.title.x = element_text(colour = "#76b82a"),
                                     axis.title.y = element_text(colour = "#76b82a"),
                                     plot.title = element_text(colour = "#76b82a"),
                                     strip.text.y = element_text(angle = 0),
                                     legend.title = element_text(size = 7), 
               legend.text = element_text(size = 7))) 
                                     
}
} else {
  print("This table cannot be produced based on the available data.") 
}
```

<br>

```{r tab12_users_graph, echo=FALSE, warning=FALSE}
if(!is.null(tab12_graph)){
tab12_graph_users<-tab12_graph[meaning!="All",.(meaning,year,atc_code_4,no_male_users,no_female_users)]
tab12_graph_users<-melt(tab12_graph_users, id.vars = c("meaning", "year","atc_code_4"), variable.name = "sex")
setnames(tab12_graph_users, "value", "count")
tab12_graph_users<-tab12_graph_users[,count:=as.numeric(count)]
tab12_graph_users<-tab12_graph_users[sex=="no_male_users", sex:="Male"][sex=="no_female_users", sex:="Female"]
fig.tab12_users<-vector(mode="list", length=length(unique(tab12_graph_users[,meaning])))
for(i in 1:length(unique(tab12_graph_users[,meaning]))) {
fig.tab12_users[[i]]<-ggplotly(ggplot(tab12_graph_users[meaning==unique(tab12_graph_users[,meaning])[i]], aes(x = year, y = count, group=atc_code_4)) +
                           geom_line(aes(color=atc_code_4)) +
                           geom_point(aes(color=atc_code_4)) + 
                            facet_wrap(~ sex, ncol=2, scales = "fixed") +
                               ggtitle(paste0("Number of subjects by ATC code, year and sex, meaning:", unique(tab12_graph_users[,meaning])[i])) + 
                               xlab("Year") +
                               ylab("Count")+
                             theme_classic() +
                             guides(shape = guide_legend(override.aes = list(size = 0.3))) +
                               theme(text=element_text(size=10),
                                 axis.text.x = element_text(angle = 90, hjust = 1),
                                     axis.title.x = element_text(colour = "#76b82a"),
                                     axis.title.y = element_text(colour = "#76b82a"),
                                     plot.title = element_text(colour = "#76b82a"),
                                     strip.text.y = element_text(angle = 0),
                                     legend.title = element_text(size = 7), 
               legend.text = element_text(size = 7))) 
                                     
}

#Move the x axis title down so it doesn't overlap with the labels
for (i in 1: length(fig.tab12_users)){
fig.tab12_users[[i]][['x']][['layout']][['annotations']][[1]][['y']] <--0.15
}
}


```

```{r display_tab12_users_graph, echo=FALSE}
if(!is.null(tab12_graph)){
htmltools::tagList(list(fig.tab12_users))
} else {
  print("This table cannot be produced based on the available data.") 
}
```

<br>

```{r tab12_median_graph, echo=FALSE, warning=FALSE}
if(!is.null(tab12_graph)){
tab12_graph_median<-tab12_graph[meaning!="All",.(meaning,year,atc_code_4,median_rx_male_users,median_rx_female_users)]
tab12_graph_median<-melt(tab12_graph_median, id.vars = c("meaning", "year","atc_code_4"), variable.name = "sex")
setnames(tab12_graph_median, "value", "median_prescriptions")
tab12_graph_median<-tab12_graph_median[,median_prescriptions:=as.numeric(median_prescriptions)]
tab12_graph_median<-tab12_graph_median[sex=="median_rx_male_users", sex:="Male"][sex=="median_rx_female_users", sex:="Female"]
fig.tab12_median<-vector(mode="list", length=length(unique(tab12_graph_median[,meaning])))
for(i in 1:length(unique(tab12_graph_median[,meaning]))) {
fig.tab12_median[[i]]<-ggplotly(ggplot(tab12_graph_median[meaning==unique(tab12_graph_median[,meaning])[i]], aes(x = year, y = median_prescriptions, group=atc_code_4)) +
                           geom_line(aes(color=atc_code_4)) +
                           geom_point(aes(color=atc_code_4)) + 
                            facet_wrap(~ sex, ncol=2, scales = "fixed") +
                               ggtitle(paste0("Median number of prescriptions by ATC code, year and sex, meaning:",unique(tab12_graph_median[,meaning])[i])) + 
                               xlab("Year") +
                               ylab("Count")+
                             theme_classic() +
                             guides(shape = guide_legend(override.aes = list(size = 0.3))) +
                               theme(text=element_text(size=10),
                                 axis.text.x = element_text(angle = 90, hjust = 1),
                                     axis.title.x = element_text(colour = "#76b82a"),
                                     axis.title.y = element_text(colour = "#76b82a"),
                                     plot.title = element_text(colour = "#76b82a"),
                                     strip.text.y = element_text(angle = 0),
                                     legend.title = element_text(size = 7), 
               legend.text = element_text(size = 7))) 
                                     
}

#Move the x axis title down so it doesn't overlap with the labels
for (i in 1: length(fig.tab12_median)){
fig.tab12_median[[i]][['x']][['layout']][['annotations']][[1]][['y']] <--0.15
}
}


```

```{r display_tab12_median_graph, echo=FALSE}
if(!is.null(tab12_graph)){
htmltools::tagList(list(fig.tab12_median))
} else {
  print("This table cannot be produced based on the available data.") 
}
```

<br>

#### Number of records and users by ATC code, year and meaning

```{r counts_atc_7_my, echo=F}
if (subpopulations_present=="No"){
  if(sum(grepl(list.files(paste0(med_dir,"Masked/")), pattern="medicines_my_atc_7_masked.csv"))>0){
tab13<-fread(paste0(med_dir,"Masked/", "medicines_my_atc_7_masked.csv"))
setcolorder(tab13,c("atc_code_7", "no_records", "no_male_users", "median_rx_male_users", "no_female_users", "median_rx_female_users","meaning", "year", "atc_code_3", "data_access_provider", "data_source"))

if(tab13[,.N]>0){
  if(tab13[,.N]>12000){
      print("If the table contanins more than 12000 records it can not be displayed in the report. For the complete table, go to g_output/MEDICINES/medicines_my_atc_7_masked.csv")
    datatable(head(tab13,12000), options = list(scrollX=T))
  } else {
  datatable(tab13, options = list(scrollX=T))
  }
} else {
  tab13<-NULL
    print("This table cannot be produced based on the available data.")
}
  } else {
    tab13<-NULL
    print("This table cannot be produced based on the available data.")
}
} else {
    if(sum(grepl(list.files(paste0(med_dir,subpopulations_names[a], "/Masked/")), pattern="medicines_my_atc_7_masked.csv"))>0){
  tab13<-fread(paste0(med_dir,subpopulations_names[a], "/Masked/", subpopulations_names[a],"_medicines_my_atc_7_masked.csv"))
  if(tab13[,.N]>0){
  setcolorder(tab13,c("atc_code_7", "no_records", "no_male_users", "median_rx_male_users", "no_female_users", "median_rx_female_users","meaning", "year", "atc_code_3", "data_access_provider", "data_source"))
        if(tab13[,.N]>12000){
    print("If the table contanins more than 12000 records it can not be displayed in the report. For the complete table, go to g_output/MEDICINES/medicines_my_atc_7_masked.csv")
            datatable(head(tab13,12000), options = list(scrollX=T))
        } else {
    datatable(tab13, options = list(scrollX=T))
        }
  } else {
    tab13<-NULL
    print("This table cannot be produced based on the available data.")
}
    } else {
      tab13<-NULL
    print("This table cannot be produced based on the available data.")
    }
} 
```

</div>

<br>

<div class = 'box5'>

## 4. Counts in females of childbearing age (12-55 years old)

#### Number of records by ATC code, meaning and year

```{r counts_atc_1_f_my, echo=F}
if (subpopulations_present=="No"){
  if(sum(grepl(list.files(paste0(med_dir,"Masked/")), pattern="medicines_my_atc_1_f_masked.csv"))>0){
tab11<-fread(paste0(med_dir,"Masked/", "medicines_my_atc_1_f_masked.csv"))
if(tab11[,.N]>0){
  setcolorder(tab11,c("atc_code_1", "count","total", "meaning", "year", "data_access_provider", "data_source"))
    if(tab11[,.N]>12000){  
  print("If the table contanins more than 12000 records it can not be displayed in the report. For the complete table, go to g_output/MEDICINES/medicines_my_atc_1_f_masked.csv")
       datatable(head(tab11,12000), options = list(scrollX=T))
    } else {
  datatable(tab11, options = list(scrollX=T))
    }
} else {
  tab11<-NULL
    print("This table cannot be produced based on the available data.")
}
  } else {
    tab11<-NULL
    print("This table cannot be produced based on the available data.")
}
} else {
    if(sum(grepl(list.files(paste0(med_dir,subpopulations_names[a], "/Masked/")), pattern="medicines_my_atc_1_f_masked.csv"))>0){
  tab11<-fread(paste0(med_dir,subpopulations_names[a], "/Masked/", subpopulations_names[a],"_medicines_my_atc_1_f_masked.csv"))
  if(tab11[,.N]>0){
    setcolorder(tab11,c("atc_code_1", "count", "meaning", "year", "data_access_provider", "data_source"))
          if(tab11[,.N]>12000){
    print("If the table contanins more than 12000 records it can not be displayed in the report. For the complete table, go to g_output/MEDICINES/medicines_my_atc_1_f_masked.csv")
                   datatable(head(tab11,12000), options = list(scrollX=T))
    } else {
    datatable(tab11, options = list(scrollX=T))
    }
  } else {
    tab11<-NULL
    print("This table cannot be produced based on the available data.")
}
    } else {
      tab11<-NULL
   print("This table cannot be produced based on the available data.")
    }
} 
```

<br>

```{r tab11_graph, echo=FALSE, warning=FALSE}
if(!is.null(tab11)){
tab11_graph<-tab11[count=="<5", count:= 0.9]
tab11_graph<-tab11_graph[,count:=as.numeric(count)]
tab11_graph<-tab11_graph[is.na(atc_code_1),atc_code_1:="All"]
tab11_graph<-tab11_graph[,year:=as.factor(year)]
} else {
 tab11_graph<-NULL 
}

if(!is.null(tab11_graph)){
if (tab11_graph[,.N] != 0){
ggplotly(ggplot(tab11_graph, aes(x = year, y = count, group=atc_code_1)) +
                           geom_line(aes(color=atc_code_1)) +
                           geom_point(aes(color=atc_code_1)) + 
                            facet_wrap(~ meaning, ncol=2, scales = "fixed") +
                               ggtitle("Number of records by ATC code, year and meaning") + 
                               xlab("Year") +
                               ylab("Count")+
                             theme_classic() +
                             guides(shape = guide_legend(override.aes = list(size = 0.3))) +
                               theme(text=element_text(size=10),
                                 axis.text.x = element_text(angle = 90, hjust = 1),
                                     axis.title.x = element_text(colour = "#76b82a"),
                                     axis.title.y = element_text(colour = "#76b82a"),
                                     plot.title = element_text(colour = "#76b82a"),
                                     strip.text.y = element_text(angle = 0),
                                     legend.title = element_text(size = 7), 
               legend.text = element_text(size = 7))) 
                                     
}
} else {
  print("This table cannot be produced based on the available data.") 
}
```


<br>

#### Number of records by ATC code, meaning and year

```{r counts_atc_7_f_my, echo=F}
if (subpopulations_present=="No"){
  if(sum(grepl(list.files(paste0(med_dir,"Masked/")), pattern="medicines_my_atc_7_f_masked.csv"))>0){
tab14<-fread(paste0(med_dir,"Masked/", "medicines_my_atc_7_f_masked.csv"))
if (tab14[,.N]>0){
  setcolorder(tab14,c("atc_code_7", "no_records", "no_female_users", "median_rx_female_users","meaning", "year", "atc_code_3", "data_access_provider", "data_source"))
  if (tab14[,.N]>12000){
        print("If the table contanins more than 12000 records it can not be displayed in the report. For the complete table, go to g_output/MEDICINES/_medicines_my_atc_7_f_masked.csv")
   datatable(head(tab14,12000), options = list(scrollX=T)) 
  } else {
datatable(tab14, options = list(scrollX=T))
  }
} else {
  tab14<-NULL
    print("This table cannot be produced based on the available data.")
}
  } else {
    tab14<-NULL
    print("This table cannot be produced based on the available data.")
}
} else {
    if(sum(grepl(list.files(paste0(med_dir,subpopulations_names[a], "/Masked/")), pattern="medicines_my_atc_7_f_masked.csv"))>0){
  tab14<-fread(paste0(med_dir,subpopulations_names[a], "/Masked/", subpopulations_names[a],"_medicines_my_atc_7_f_masked.csv"))
  if(tab14[,.N]>0){
    setcolorder(tab14,c("atc_code_7", "no_records", "no_female_users", "median_rx_female_users","meaning", "year", "atc_code_3", "data_access_provider", "data_source"))
      if (tab14[,.N]>12000){
      print("If the table contanins more than 12000 records it can not be displayed in the report. For the complete table, go to g_output/MEDICINES/_medicines_my_atc_7_f_masked.csv")
         datatable(head(tab14,12000), options = list(scrollX=T))

         } else {
    datatable(tab14, options = list(scrollX=T))
      }
  } else {
    tab14<-NULL
    print("This table cannot be produced based on the available data.")
}
    } else {
      tab14<-NULL
    print("This table cannot be produced based on the available data.")
    }
} 
```

<br>

</div>

<div class = 'box6'>

## 5. Rates of medicine use


#### Rates of medicines exposure in females of childbearing age (12-55 years old) by year and ATC code

<br>

When subjects are being followed(i.e. they contribute to the person time in a particular year) but do not have a dispensed/prescribed medicine, the truncated_atc_code variable will be set to N/A.

```{r rates_year, echo=F}
if (subpopulations_present=="No"){
  if(sum(grepl(list.files(paste0(med_dir,"Masked/")), pattern="medicines_rates_year_atc_masked.csv"))>0){
tab15<-fread(paste0(med_dir,"Masked/", "medicines_rates_year_atc_masked.csv"))
if (tab15[,.N]>0){
  if (tab15[,.N]>12000){
        print("If the table contanins more than 12000 records it can not be displayed in the report. For the complete table, go to g_output/MEDICINES/medicines_rates_year_atc_masked.csv")
    datatable(head(tab15,12000), options = list(scrollX=T))
  } else {
datatable(tab15, options = list(scrollX=T))
  }
} else {
  tab15<-NULL
    print("This table cannot be produced based on the available data.")
}
  } else {
      tab15<-NULL
    print("This table cannot be produced based on the available data.")
}
} else {
    if(sum(grepl(list.files(paste0(med_dir,subpopulations_names[a], "/Masked/")), pattern="medicines_rates_year_atc_masked.csv"))>0){
  tab15<-fread(paste0(med_dir,subpopulations_names[a], "/Masked/", subpopulations_names[a],"_medicines_rates_year_atc_masked.csv"))
  if (tab15[,.N]>0){
   if (tab15[,.N]>12000){   
            print("If the table contanins more than 12000 records it can not be displayed in the report. For the complete table, go to g_output/MEDICINES/medicines_rates_year_atc_masked.csv")
        datatable(head(tab15,12000), options = list(scrollX=T))
   } else {
datatable(tab15, options = list(scrollX=T))
   }
  } else {
      tab15<-NULL
      print("This table cannot be produced based on the available data.")
  }
    } else {
        tab15<-NULL
    print("This table cannot be produced based on the available data.")
    }
}
```

<br>

Counts smaller than 5 will be replaced with a count of 3. Then the approximate incidence rates will be calculated as the variable of interest divided by the person years and multiplied by 100.

```{r tab15_graph_medicines, echo=FALSE, warning=FALSE}
if(!is.null(tab15)){
tab15_graph<-tab15[count_medicines=="<5", count_medicines:= 3]
tab15_graph<-tab15_graph[,count_medicines:=as.numeric(count_medicines)]
tab15_graph<-tab15_graph[no_users=="<5", no_users:= 3]
tab15_graph<-tab15_graph[,no_users:=as.numeric(no_users)]
tab15_graph<-tab15_graph[no_subjects=="<5", no_subjects:= 3]
tab15_graph<-tab15_graph[,no_subjects:=as.numeric(no_subjects)]
tab15_graph<-tab15_graph[person_years=="<5", person_years:= 3]
tab15_graph<-tab15_graph[,person_years:=as.numeric(person_years)]
tab15_graph<-tab15_graph[,year:=as.factor(year)]
tab15_graph<-tab15_graph[medicines_per_100_py=="N/A", medicines_per_100_py:= round((count_medicines/person_years)*100,2)]
tab15_graph<-tab15_graph[users_per_100_py=="N/A", users_per_100_py:= round((no_users/person_years)*100,2)]
tab15_graph<-tab15_graph[subjects_per_100_py=="N/A", subjects_per_100_py:= round((no_subjects/person_years)*100,2)]
} else {
 tab15_graph<-NULL 
}

if(!is.null(tab15_graph)){
ggplotly(ggplot(tab15_graph, aes(x = year, y = medicines_per_100_py, group=truncated_atc_code)) +
                           geom_line(aes(color=truncated_atc_code)) +
                           geom_point(aes(color=truncated_atc_code)) + 
                               ggtitle("Rate of medicine exposure in females of childbearing age") + 
                               xlab("Year") +
                               ylab("Rate per 100 person-years")+
                             theme_classic() +
                             guides(shape = guide_legend(override.aes = list(size = 0.3))) +
                               theme(text=element_text(size=10),
                                 axis.text.x = element_text(angle = 90, hjust = 1),
                                     axis.title.x = element_text(colour = "#76b82a"),
                                     axis.title.y = element_text(colour = "#76b82a"),
                                     plot.title = element_text(colour = "#76b82a"),
                                     strip.text.y = element_text(angle = 0),
                                     legend.title = element_text(size = 7), 
               legend.text = element_text(size = 7))) 
                                     
} else {
  print("This table cannot be produced based on the available data.") 
}
```


<br>

```{r tab15_graph_users, echo=F}
if(!is.null(tab15_graph)){
ggplotly(ggplot(tab15_graph, aes(x = year, y = users_per_100_py, group=truncated_atc_code)) +
                           geom_line(aes(color=truncated_atc_code)) +
                           geom_point(aes(color=truncated_atc_code)) + 
                               ggtitle("Rate of users in females of childbearing age") + 
                               xlab("Year") +
                               ylab("Rate per 100 person-years")+
                             theme_classic() +
                             guides(shape = guide_legend(override.aes = list(size = 0.3))) +
                               theme(text=element_text(size=10),
                                 axis.text.x = element_text(angle = 90, hjust = 1),
                                     axis.title.x = element_text(colour = "#76b82a"),
                                     axis.title.y = element_text(colour = "#76b82a"),
                                     plot.title = element_text(colour = "#76b82a"),
                                     strip.text.y = element_text(angle = 0),
                                     legend.title = element_text(size = 7), 
               legend.text = element_text(size = 7))) 
                                     
} else {
  print("This table cannot be produced based on the available data.") 
}
```

<br>

```{r tab15_graph_subjects, echo=F}
if(!is.null(tab15_graph)){
ggplotly(ggplot(tab15_graph, aes(x = year, y = no_subjects, group=truncated_atc_code)) +
                           geom_line(aes(color=truncated_atc_code)) +
                           geom_point(aes(color=truncated_atc_code)) + 
                               ggtitle("Rate of subjects in females of childbearing age") + 
                               xlab("Year") +
                               ylab("Rate per 100 person-years")+
                             theme_classic() +
                             guides(shape = guide_legend(override.aes = list(size = 0.3))) +
                               theme(text=element_text(size=10),
                                 axis.text.x = element_text(angle = 90, hjust = 1),
                                     axis.title.x = element_text(colour = "#76b82a"),
                                     axis.title.y = element_text(colour = "#76b82a"),
                                     plot.title = element_text(colour = "#76b82a"),
                                     strip.text.y = element_text(angle = 0),
                                     legend.title = element_text(size = 7), 
               legend.text = element_text(size = 7))) 
                                     
} else {
  print("This table cannot be produced based on the available data.") 
}
```

#### Rates of medicines exposure in females of childbearing age (12-55 years old) by year, age and ATC code

<br>

When subjects are being followed(i.e. they contribute to the person time in a particular year) but do not have a dispensed/prescribed medicine, the `truncated_atc_code` variable will be set to N/A.

```{r rates_year_age, echo=F}
if (subpopulations_present=="No"){
  if(sum(grepl(list.files(paste0(med_dir,"Masked/")), pattern="medicines_rates_year_age_atc_masked.csv"))>0){
tab16<-fread(paste0(med_dir,"Masked/", "medicines_rates_year_age_atc_masked.csv"))
if (tab16[,.N]>0){
  if (tab16[,.N]>12000){
print("If the table contanins more than 12000 records it can not be displayed in the report. For the complete table, go to g_output/MEDICINES/medicines_rates_year_age_atc_masked.csv")
datatable(head(tab16,12000), options = list(scrollX=T))
  } else {
datatable(tab16, options = list(scrollX=T))  
  }
} else {
    tab16<-NULL
    print("This table cannot be produced based on the available data.")
}
  } else {
    tab16<-NULL
    print("This table cannot be produced based on the available data.")
}
} else {
    if(sum(grepl(list.files(paste0(med_dir,subpopulations_names[a], "/Masked/")), pattern="medicines_rates_by_year_age_atc_masked.csv"))>0){
  tab16<-fread(paste0(med_dir,subpopulations_names[a], "/Masked/", subpopulations_names[a],"_medicines_rates_year_age_atc_masked.csv"))
  if (tab16[,.N]>0){
    if(tab16[,.N]>12000){
      print("If the table contanins more than 12000 records it can not be displayed in the report. For the complete table, go to g_output/MEDICINES/medicines_rates_year_age_atc_masked.csv")
datatable(head(tab16,12000), options = list(scrollX=T))
    } else {
      datatable(tab16, options = list(scrollX=T))
    }
  } else {
    tab16<-NULL
      print("This table cannot be produced based on the available data.")
  }
    } else {
      tab16<-NULL
    print("This table cannot be produced based on the available data.")
    }
}
```

Counts smaller than 5 will be replaced with a count of 3. Then the approximate incidence rates will be calculated as the variable of interest divided by the person years and multiplied by 100.

```{r tab16_graph_med, echo=FALSE, warning=FALSE}
if(!is.null(tab16)){
tab16_graph<-tab16[count_medicines=="<5", count_medicines:= 3]
tab16_graph<-tab16_graph[,count_medicines:=as.numeric(count_medicines)]
tab16_graph<-tab16_graph[person_years=="<5", person_years:= 3]
tab16_graph<-tab16_graph[,person_years:=as.numeric(person_years)]
tab16_graph<-tab16_graph[no_users=="<5", no_users:= 3]
tab16_graph<-tab16_graph[,no_users:=as.numeric(no_users)]
tab16_graph<-tab16_graph[no_subjects=="<5", no_subjects:= 3]
tab16_graph<-tab16_graph[,no_subjects:=as.numeric(no_subjects)]
tab16_graph<-tab16_graph[,year:=as.factor(year)]

tab16_graph<-tab16_graph[medicines_per_100_py=="N/A",medicines_per_100_py:=round((count_medicines/person_years)*100,2)]
tab16_graph<-tab16_graph[users_per_100_py=="N/A", users_per_100_py:= round((no_users/person_years)*100,2)]
tab16_graph<-tab16_graph[subjects_per_100_py=="N/A", subjects_per_100_py:= round((no_subjects/person_years)*100,2)]

} else {
 tab16_graph<-NULL 
}

if(!is.null(tab16_graph)){
fig.tab16_med<-vector(mode="list", length=length(unique(tab16_graph[,age_band])))
for(i in 1:length(unique(tab16_graph[,age_band]))){
fig.tab16_med[[i]]<-ggplotly(ggplot(tab16_graph[age_band==unique(tab16_graph[,age_band])[i]], aes(x = year, y = medicines_per_100_py, group=truncated_atc_code)) +
                           geom_line(aes(color=truncated_atc_code)) +
                           geom_point(aes(color=truncated_atc_code)) + 
                               ggtitle(paste0("Rate of medicine exposure in females of childbearing age, age band:", unique(tab16_graph[,age_band])[i])) + 
                               xlab("Year") +
                               ylab("Rate per 100 person-years")+
                             theme_classic() +
                             guides(shape = guide_legend(override.aes = list(size = 0.3))) +
                               theme(text=element_text(size=10),
                                 axis.text.x = element_text(angle = 90, hjust = 1),
                                     axis.title.x = element_text(colour = "#76b82a"),
                                     axis.title.y = element_text(colour = "#76b82a"),
                                     plot.title = element_text(colour = "#76b82a"),
                                     strip.text.y = element_text(angle = 0),
                                     legend.title = element_text(size = 7), 
               legend.text = element_text(size = 7))) 
                                     
}
}
```

```{r display_tab16_med_graph, echo=FALSE}
if(!is.null(tab16_graph)){
htmltools::tagList(list(fig.tab16_med))
} else {
  print("This table cannot be produced based on the available data.") 
}
```

<br>

```{r tab16_graph_users, echo=FALSE, warning=FALSE}
if(!is.null(tab16_graph)){
fig.tab16_user<-vector(mode="list", length=length(unique(tab16_graph[,age_band])))
for(i in 1:length(unique(tab16_graph[,age_band]))){
fig.tab16_user[[i]]<-ggplotly(ggplot(tab16_graph[age_band==unique(tab16_graph[,age_band])[i]], aes(x = year, y = users_per_100_py, group=truncated_atc_code)) +
                           geom_line(aes(color=truncated_atc_code)) +
                           geom_point(aes(color=truncated_atc_code)) + 
                               ggtitle(paste0("Rate of users in females of childbearing age, age band:", unique(tab16_graph[,age_band])[i])) + 
                               xlab("Year") +
                               ylab("Rate per 100 person-years")+
                             theme_classic() +
                             guides(shape = guide_legend(override.aes = list(size = 0.3))) +
                               theme(text=element_text(size=10),
                                 axis.text.x = element_text(angle = 90, hjust = 1),
                                     axis.title.x = element_text(colour = "#76b82a"),
                                     axis.title.y = element_text(colour = "#76b82a"),
                                     plot.title = element_text(colour = "#76b82a"),
                                     strip.text.y = element_text(angle = 0),
                                     legend.title = element_text(size = 7), 
               legend.text = element_text(size = 7))) 
                                     
}
}
```

```{r display_tab16_users_graph, echo=FALSE}
if(!is.null(tab16_graph)){
htmltools::tagList(list(fig.tab16_user))
} else {
  print("This table cannot be produced based on the available data.") 
}
```

<br>

```{r tab16_graph_subjects, echo=FALSE, warning=FALSE}
if(!is.null(tab16_graph)){
fig.tab16_subjects<-vector(mode="list", length=length(unique(tab16_graph[,age_band])))
for(i in 1:length(unique(tab16_graph[,age_band]))){
fig.tab16_subjects[[i]]<-ggplotly(ggplot(tab16_graph[age_band==unique(tab16_graph[,age_band])[i]], aes(x = year, y = subjects_per_100_py, group=truncated_atc_code)) +
                           geom_line(aes(color=truncated_atc_code)) +
                           geom_point(aes(color=truncated_atc_code)) + 
                               ggtitle(paste0("Rate of subjects in females of childbearing age, age band:", unique(tab16_graph[,age_band])[i])) + 
                               xlab("Year") +
                               ylab("Rate per 100 person-years")+
                             theme_classic() +
                             guides(shape = guide_legend(override.aes = list(size = 0.3))) +
                               theme(text=element_text(size=10),
                                 axis.text.x = element_text(angle = 90, hjust = 1),
                                     axis.title.x = element_text(colour = "#76b82a"),
                                     axis.title.y = element_text(colour = "#76b82a"),
                                     plot.title = element_text(colour = "#76b82a"),
                                     strip.text.y = element_text(angle = 0),
                                     legend.title = element_text(size = 7), 
               legend.text = element_text(size = 7))) 
                                     
}
}
```

```{r display_tab16_subjects_graph, echo=FALSE}
if(!is.null(tab16_graph)){
htmltools::tagList(list(fig.tab16_subjects))
} else {
  print("This table cannot be produced based on the available data.") 
}
```

</div>

<div class = 'box7'>

## 6. Data completeness

#### Number of records with incomplete data

```{r completeness, echo=F}
if (subpopulations_present=="No"){
  if(sum(grepl(list.files(paste0(med_dir,"Masked/")), pattern="medicines_completeness_masked.csv"))>0){
tab15<-fread(paste0(med_dir,"Masked/", "medicines_completeness_masked.csv"))
if (tab15[,.N]>0){
datatable(tab15, options = list(scrollX=T))
} else {
  tab15<-NULL
    print("This table cannot be produced based on the available data.")
}
  } else {
    tab15<-NULL
    print("This table cannot be produced based on the available data.")
}
} else {
    if(sum(grepl(list.files(paste0(med_dir,subpopulations_names[a], "/Masked/")), pattern="medicines_completeness_masked.csv"))>0){
  tab15<-fread(paste0(med_dir,subpopulations_names[a], "/Masked/", subpopulations_names[a],"_medicines_completeness_masked.csv"))
  if (tab15[,.N]>0){
datatable(tab15, options = list(scrollX=T))
  } else {
    tab15<-NULL
      print("This table cannot be produced based on the available data.")
  }
    } else {
      tab15<-NULL
    print("This table cannot be produced based on the available data.")
    }
}
```

</div>

<br>

<div class = 'box8'>

## 7. Calculations


```{r calculations_table, echo=FALSE}
calculations_medicines<-data.table(rbind(
   cbind(indicator= "Number of records by ATC code, meaning and year",
          variable_name=c("count", "total"),
         stratifying_variable=c("medicinal_product_atc_code(truncated to first level), meaning of record and year", "medicinal_product_atc_code(truncated to first level), meaning of record and year"),
         calculation=c("Number of records for a particular medicinal group as defined by the first letter of the ATC code stratified by the meaning of the record and year", "Total number of records stratified by the meaning of the record and year")),
  cbind(indicator= "Number of records and users by ATC code, meaning and year",           variable_name=c("no_records", "no_male_users", "median_rx_male_users","no_female_users","median_rx_female_users"),
         stratifying_variable=c("medicinal_product_atc_code(truncated to first letter, third or fourth letter of the ATC code)",
                                "medicinal_product_atc_code(truncated to first letter, third or fourth letter of the ATC code)",
                                "medicinal_product_atc_code(truncated to first letter, third or fourth letter of the ATC code)",
                                "medicinal_product_atc_code(truncated to first letter, third or fourth letter of the ATC code)",
                                "medicinal_product_atc_code(truncated to first letter, third or fourth letter of the ATC code)",
                                "medicinal_product_atc_code(truncated to first letter, third or fourth letter of the ATC code), meaning of record and year",
                                "medicinal_product_atc_code(truncated to first letter, third or fourth letter of the ATC code), meaning of record and year","medicinal_product_atc_code(truncated to first letter, third or fourth letter of the ATC code), meaning of record and year","medicinal_product_atc_code(truncated to first letter, third or fourth letter of the ATC code), meaning of record and year","medicinal_product_atc_code(truncated to first letter, third or fourth letter of the ATC code), meaning of record and year"),
         calculation=c("Number of records for a particular medicinal group as defined by the first, third or fourth letter of the ATC code stratified(if a medicinal product has an ATC code up to 3 letter then the atc_code_4 will show as N/A, same for ATC code up to one letter)", "Number of male users for a medicinal product with a particular ATC code as defined by the number of letters of the ATC code", "Median number of records for male users for a medicinal product with a particular ATC code as defined by the number of letters of the ATC code","Number of female users for a medicinal product with a particular ATC code as defined by the number of letters of the ATC code", "Median number of records for female users for a medicinal product with a particular ATC code as defined by the number of letters of the ATC code", "Number of records for a particular medicinal group as defined by the first, third or fourth letter of the ATC code stratified by the meaning of the record and year(if a medicinal product has an ATC code up to 3 letter then the atc_code_4 will show as N/A, same for ATC code up to one letter)", "Number of male users for a medicinal product with a particular ATC code as defined by the number of letters of the ATC code stratified by the meaning of the record and year", "Median number of records for male users for a medicinal product with a particular ATC code as defined by the number of letters of the ATC code stratified by the meaning of the record and year","Number of female users for a medicinal product with a particular ATC code as defined by the number of letters of the ATC code stratified by the meaning of the record and year", "Median number of records for female users for a medicinal product with a particular ATC code as defined by the number of letters of the ATC code stratified by the meaning of the record and year")),
  cbind(indicator= "Number of records and users by ATC code, meaning and year(atc code up to seven letters)",           variable_name=c("no_records", "no_male_users", "median_rx_male_users","no_female_users","median_rx_female_users"),
         stratifying_variable=c("medicinal_product_atc_code",
                                "medicinal_product_atc_code",
                                "medicinal_product_atc_code",
                                "medicinal_product_atc_code",
                                "medicinal_product_atc_code",
                                "medicinal_product_atc_code, meaning of record and year",
                                "medicinal_product_atc_code, meaning of record and year","medicinal_product_atc_code, meaning of record and year","medicinal_product_atc_code, meaning of record and year","medicinal_product_atc_code, meaning of record and year"
                                ),
         calculation=c("Number of records for a particular medicinal group", "Number of male users for a medicinal product", "Median number of records for male users for a medicinal product","Number of female users for a medicinal product", "Median number of records for female users for a medicinal product", "Number of records for a particular medicinal group stratified by the meaning of the record and year", "Number of male users for a medicinal product with a particular ATC code stratified by the meaning of the record and year", "Median number of records for male users for a medicinal product stratified by the meaning of the record and year","Number of female users for a medicinal product stratified by the meaning of the record and year", "Median number of records for female users for a medicinal product stratified by the meaning of the record and year")),
  cbind(indicator= "Number of records by ATC code, meaning and year in females of childbearing age(12-55 years old at start of follow up)",
          variable_name=c("count", "total"),
         stratifying_variable=c("medicinal_product_atc_code(truncated to first level), meaning of record and year", "medicinal_product_atc_code(truncated to first level), meaning of record and year"),
         calculation=c("Number of records for a particular medicinal group as defined by the first letter of the ATC code stratified by the meaning of the record and year in females of childbearing age(12-55 years old at start of follow up)", "Total number of records stratified by the meaning of the record and year in females of childbearing age(12-55 years old at start of follow up)")),
  cbind(indicator= "Number of records and users by ATC code, meaning and year(atc code up to seven letters) in females of childbearing age(12-55 years old at start of follow up)",           variable_name=c("no_records", "no_female_users","median_rx_female_users"),
         stratifying_variable=c("medicinal_product_atc_code",
                                "medicinal_product_atc_code",
                                "medicinal_product_atc_code",
                                "medicinal_product_atc_code, meaning of record and year","medicinal_product_atc_code, meaning of record and year","medicinal_product_atc_code, meaning of record and year"
                                ),
         calculation=c("Number of records for a particular medicinal group in females of childbearing age(12-55 years old at start of follow up)", "Number of female users of childbearing age(12-55 years old at start of follow up) for a medicinal product", "Median number of records for female users of childbearing age(12-55 years old at start of follow up) for a medicinal product", "Number of records for a particular medicinal group stratified by the meaning of the record and year in females of childbearing age(12-55 years old at start of follow up)", "Number of female users of childbearing age(12-55 years old at start of follow up) for a medicinal product stratified by the meaning of the record and year", "Median number of records for female users of childbearing age(12-55 years old at start of follow up) for a medicinal product stratified by the meaning of the record and year")),
  cbind(indicator= "Rate of medicines prescriptions/dispensing by year in females of childbearing age(12-55 years old at start of follow up)",           variable_name=c("count_medicines", "no_users","no_subjects","person_years"),
         stratifying_variable=c("medicinal_product_atc_code(truncated to three letters) and year",
                                "medicinal_product_atc_code(truncated to three letters) and year",
                                "year",
                                "year"),
         calculation=c("Number of records for a particular medicinal group in females of childbearing age(12-55 years old at start of follow up) by year", "Number of female users of childbearing age(12-55 years old at start of follow up) who are dispensed/prescribed a medicinal product in a particular year", "Number of female subjects of childbearing age(12-55 years old at start of follow up) who are present(i.e. contribute to the person time) in a particular year", "Follow up time by year in females of childbearing age(12-55 years old at start of follow up)" )),
  cbind(indicator= "Rate of medicines prescriptions/dispensing by year and age band in females of childbearing age(12-55 years old at start of follow up)",           variable_name=c("count_medicines", "no_users","no_subjects","person_years"),
         stratifying_variable=c("medicinal_product_atc_code(truncated to three letters), age_band and year",
                                "medicinal_product_atc_code(truncated to three letters), age_band and year",
                                "year and age_band",
                                "year and age_band"),
         calculation=c("Number of records for a particular medicinal group in females of childbearing age(12-55 years old at start of follow up) by year and age_band", "Number of female users of childbearing age(12-55 years old at start of follow up) who are dispensed/prescribed a medicinal product in a particular year by age_band", "Number of female subjects of childbearing age(12-55 years old at start of follow up) who are present(i.e. contribute to the person time) in a particular year by age_band", "Follow up time by year and age_band in females of childbearing age(12-55 years old at start of follow up)" )),
  cbind(indicator= "Data completeness", 
        variable_name=c("records_study_population", "records_study_population", "records_no_indication_code", "records_no_indication_code","records_no_prescriber_speciality","records_no_prescriber_speciality","records_no_dispensed_quantity","records_no_dispensed_quantity","records_no_prescribed_quantity","records_no_prescribed_quantity","records_no_prescribed_quantity_unit","records_no_prescribed_quantity_unit"),
        stratifying_variable=c("meaning of record","All","meaning of record","All","meaning of record","All","meaning of record","All","meaning of record","All","meaning of record","All"), 
        calculation=c("Total number of records present in te medicines_study_population stratifed by meaning", "Total number of records present in te medicines_study_population", "Number of records with missing indication_code when indication_code_vocabulary is present stratified by meaning","Number of records with missing indication_code when indication_code_vocabulary is present","Number of records with missing prescriber_speciality when prescriber_speciality_vocabulary is present stratified by meaning","Number of records with missing prescriber_speciality code when prescriber_speciality_vocabulary is present","Number of records with missing disp_number_medicinal_product stratified by meaning","Number of records with missing disp_number_medicinal_product","Number of records with missing presc_quantity_per_day stratified by meaning","Number of records with missing presc_quantity_per_day","Number of records with missing presc_quantity_unit when presc_quantity_per_day is present stratified by meaning","Number of records with missing presc_quantity_unit code when presc_quantity_per_day is present"))))
datatable(calculations_medicines)
```

</div>

<br>

<div class = 'box9'>

**Author:** Vjola Hoxhaj Drs.   
**email:** v.hoxhaj@umcutrecht.nl   
**Organisation:** UMC Utrecht, Utrecht, The Netherlands   

</div>
